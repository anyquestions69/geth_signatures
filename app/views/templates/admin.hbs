<!DOCTYPE html>
<html lang="en" >
<head>
  {{>meta}}
    
    <title>Добавить занятие</title>
</head>
<body class="" >
  {{>nav}}
    <div class="container bg-primary-subtle">  
     
            <form  enctype="multipart/form-data" id="file-form">
                
                <div class="form-floating mb-2">
                    <input type="text" class="form-control" name="title" id="file-title" placeholder="Название">
                </div>
                 <div class="form-floating mb-2">
                    <input type="file" class="form-control" name="file" id="file-file" placeholder="Файл">
                </div>
                <div id="validationServerUsernameFeedback" class="text-danger"></div>
                <div id="file-success" class="text-success"></div>
                <button class="w-100 btn btn-lg btn-primary" type="button" id="file-submit">Выложить</button>
            </form>
      
       

       
         
              
              
                  </div>
{{>footer}} 
<script type="text/javascript">
    $(window).on('load', function() {


      fetch(`/api/users`).then(response => response.json()).then(res=>{
        for( let r of res){
          let li = `<li class="list-group-item d-flex justify-content-between align-items-center">
                      ${r.wallet} ${r.name}
                      <div class="btn-group" role="group" aria-label="Basic example">
                      <a style="color:white" class="btn btn-secondary">Редактировать</a>
                      <a style="color:white" class="btn btn-danger">Удалить</a>
                      </div>
                  </li>
                  `
            $('#user-list').append(li)
        }
      })


    $("#file-submit").on('click',async()=>{ //file
        const formData = new FormData();
        const fileField = $('#file-file')[0];
        
        formData.append("title", $('#file-title').val());
        formData.append("file", fileField.files[0]);
        let response = await fetch('/api/files',{
        method: 'POST',
        body: formData
        })
        let text = await response.text()

        if(response.ok){
          let newactivity = JSON.parse(text )
          console.log(newactivity)
            $('#validationServerUsernameFeedback').empty()
          $('#act-success').empty().append(`<p>Успешно добавлено занятие <a href="/activities/${newactivity.id}">${newactivity.name}</a></p>`)
        }else{
        console.log(text)
          $('#act-success').empty()
            $('#validationServerUsernameFeedback').empty().append(`<p>${text}</p>`)
            
            $('#activity-form>input').css('border-color', 'red'); 
        } 
    }) //activity

        $("#cat-submit").on('click',async()=>{ //category
        const user = {
          name:$('#cat-title').val()
        }
        let response = await fetch('/api/categories',{
        method: 'POST',
        headers: {
          'Content-Type': 'application/json;charset=utf-8'
        },
        body: JSON.stringify(user)
        })
        let text = await response.text()

        if(response.ok){
          let newactivity = JSON.parse(text )
          console.log(newactivity)
            $('#catValid').empty()
          $('#cat-success').empty().append(`<p>Успешно добавлена категория <a href="/activities/${newactivity.id}">${newactivity.name}</a></p>`)
        }else{
        console.log(text)
          $('#cat-success').empty()
            $('#catValid').empty().append(`<p>${text}</p>`)
            
            $('#category-form>input').css('border-color', 'red'); 
        }
    })

    })
    
</script>

</body>
</html>